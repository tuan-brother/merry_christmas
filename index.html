<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üéÑ Christmas 3D Game</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: radial-gradient(circle at bottom, #012, #000);
}
#tap {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 22px;
  font-family: Arial;
  background: rgba(0,0,0,0.6);
  z-index: 10;
}
#result {
  position: fixed;
  top: 40%;
  width: 100%;
  text-align: center;
  font-size: 32px;
  color: gold;
  display: none;
  font-family: Arial;
}
</style>
</head>

<body>
<div id="tap">üëÜ Ch·∫°m ƒë·ªÉ b·∫Øt ƒë·∫ßu game üéÆ</div>
<div id="result"></div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

let scene, camera, renderer, controls;
let gifts = [], opened = false;
let particles = [];

document.getElementById("tap").onclick = () => {
  document.getElementById("tap").remove();
  init();
  animate();
};

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x000010);

  camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 100);
  camera.position.set(0, 4, 9);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  scene.add(new THREE.AmbientLight(0xffffff, 0.7));
  const light = new THREE.PointLight(0xffffff, 1.5);
  light.position.set(5, 6, 5);
  scene.add(light);

  const tree = new THREE.Group();
  scene.add(tree);

  const green = new THREE.MeshStandardMaterial({ color: 0x0b6623 });
  for (let i = 0; i < 3; i++) {
    const cone = new THREE.Mesh(
      new THREE.ConeGeometry(2 - i * 0.5, 2.5, 32),
      green
    );
    cone.position.y = i * 1.3;
    tree.add(cone);
  }

  const trunk = new THREE.Mesh(
    new THREE.CylinderGeometry(0.3, 0.4, 1),
    new THREE.MeshStandardMaterial({ color: 0x8b5a2b })
  );
  trunk.position.y = -1;
  tree.add(trunk);

  // Gifts
  const geo = new THREE.BoxGeometry(0.4, 0.3, 0.1);
  for (let i = 0; i < 5; i++) {
    const gift = new THREE.Mesh(
      geo,
      new THREE.MeshStandardMaterial({ color: 0xff3333 })
    );
    const a = i * (Math.PI * 2 / 5);
    gift.position.set(Math.cos(a) * 1.4, 1.2, Math.sin(a) * 1.4);
    tree.add(gift);
    gifts.push(gift);
  }

  window.addEventListener("pointerdown", pickGift);
  window.addEventListener("resize", onResize);
}

function pickGift(e) {
  if (opened) return;

  const mouse = new THREE.Vector2(
    (e.clientX / innerWidth) * 2 - 1,
    -(e.clientY / innerHeight) * 2 + 1
  );

  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse, camera);

  const hit = raycaster.intersectObjects(gifts);
  if (hit.length) {
    opened = true;
    hit[0].object.material.color.set(0xffff00);

    const rewards = [50000, 100000, 150000, 200000, 300000];
    const money = rewards[Math.floor(Math.random() * rewards.length)];

    const r = document.getElementById("result");
    r.innerHTML = `üéâ B·∫°n nh·∫≠n ƒë∆∞·ª£c<br><b>${money.toLocaleString()} VNƒê</b>`;
    r.style.display = "block";

    fireHeart();
  }
}

// Firework heart
function fireHeart() {
  const shape = [];
  for (let t = 0; t < Math.PI * 2; t += 0.15) {
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t);
    shape.push(new THREE.Vector3(x * 0.03, y * 0.03 + 2, 0));
  }

  shape.forEach(p => {
    particles.push({
      pos: p.clone(),
      vel: new THREE.Vector3(
        (Math.random() - 0.5) * 0.05,
        (Math.random() - 0.5) * 0.05,
        (Math.random() - 0.5) * 0.05
      ),
      life: 120,
      color: new THREE.Color(`hsl(${Math.random() * 360},100%,60%)`)
    });
  });
}

const fwGeo = new THREE.BufferGeometry();
const fwMat = new THREE.PointsMaterial({ size: 0.08, vertexColors: true });
const fw = new THREE.Points(fwGeo, fwMat);

function animate() {
  requestAnimationFrame(animate);
  controls.update();

  const pos = [], col = [];
  particles = particles.filter(p => p.life-- > 0);
  particles.forEach(p => {
    p.pos.add(p.vel);
    pos.push(p.pos.x, p.pos.y, p.pos.z);
    col.push(p.color.r, p.color.g, p.color.b);
  });

  fwGeo.setAttribute("position", new THREE.Float32BufferAttribute(pos, 3));
  fwGeo.setAttribute("color", new THREE.Float32BufferAttribute(col, 3));
  if (!scene.children.includes(fw)) scene.add(fw);

  renderer.render(scene, camera);
}

function onResize() {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
}
</script>
</body>
</html>
